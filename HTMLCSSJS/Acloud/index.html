<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title></title>
	</head>
	<link rel="stylesheet" type="text/css" href="js/layui-v2.5.6/layui/css/layui.css"/>
	<script src="js/jquery-3.4.1.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/layui-v2.5.6/layui/layui.all.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/layui-v2.5.6/layui/layui.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		function change(i){
				$(".table2trclasas").hide()
				$(".table2trclasas"+i+"").show()
		}
	</script>
	<script>
	layui.use(['table', 'element','form','layer'], function(){
		var form = layui.form;
	  var element = layui.element;
	  var table = layui.table;
	  
	  
	  $("#allchecked").click(function(){
		 $.each($("input:checkbox:checked"),function(index,item){
			if(item.checked){
				
			}else{
				item.checked=true;
			}
		 })
	  })
	  
	  $("#getTables").click(function(){
	      $.ajax({
	  		url:"http://localhost:8080/DB/getTableinfo",
	  		type:"post",
	  		data:{"host":$("#hostinput").val(),"port":$("#portinput").val(),"username":$("#usernameinput").val(),"password":$("#passwordinput").val(),"database":$("#databaseinput").val()},
	  		dataType:"json",
	  		success:function(rtnData){
				
	  			layer.msg('获取成功！');
				$(".tablelist").remove();
				$(".table2trclasas").remove();
				
				$("#dbInfo").animate({left:'1%',width:'22%',height:'50%'},600,function(){});
				$("#tableinfo").animate({opacity: '10'},1200,function(){});
				$("#inforight").animate({opacity: '10'},1200,function(){});
				
				for(var i=0,l=rtnData.length;i<l;i++){
				    for(var key in rtnData[i]){
					   var tbi='<tr  class="tablelist "  id="'+key+'"><td onclick="change('+i+')">'+(i+1)+'</td><td onclick="change('+i+')">'+key+'</td><td>'
							+'<input type="checkbox" value="'+key+'" >'
					   +'</td><tr>';
					   $("#tabletbody").append(tbi);
					   var ijk=1;
					   $.each(rtnData[i][key],function(index,item){
						   var table2tr='<tr style=" display: none; " class="table2trclasas table2trclasas'+i+'"><td>'+ijk+'</td><td>'+item.Field+'</td><td>'+item.Type+'</td><td>'+item.Null+'</td><td>'+item.Key+'</td><td>'+(item.Default==undefined?"":item.Default)+'</td>'
						   +'<td>'+item.Comment+'</td></tr>';
						   $("#tabletbody2").append(table2tr);
						   ijk++;
					   })
					}
				}

	  		},
	  		error:function(XMLHttpRequest){
	  			layer.alert(XMLHttpRequest.responseText, {icon: 2})
	  		}
	  	})
	  });
	  
	  $("#creatJavaFile").click(function(){
		  var needCreat="";	  
		  $.each($("input:checkbox:checked"),function(index,item){
				  if(index==0){
					  needCreat+=item.value
				  }else{
					  needCreat+=","+item.value
				  }
		  })
		  
		  
		  $.ajax({
			  url:"http://localhost:8080/DB/creatJavaFile",
			  type:"post",
			  data:{"host":$("#hostinput").val(),"port":$("#portinput").val(),"username":$("#usernameinput").val(),"password":$("#passwordinput").val(),"database":$("#databaseinput").val(),"needCreat":needCreat},
			  dataType:"json",
			  success:function(rtnData){
				  
			  },
			  error:function(XMLHttpRequest){
	  			layer.alert(XMLHttpRequest.responseText, {icon: 1})
				window.location.href = "http://localhost:8080/DB/downloadcode";
			  }
		  })
		  
	  })
	  
	
		
	});
	</script>
	<body>
		<br><br><br>
				<div id="dbInfo" style="width: 40%;position: relative;left: 30%; ">
					<form class="layui-form" action="">
						
						<blockquote class="layui-elem-quote">数据库设置</blockquote>
					  <div class="layui-form-item">
					    <label class="layui-form-label">数据库地址</label>
					    <div class="layui-input-block">
					      <input type="text"  id="hostinput"  name="title" required  lay-verify="required" value="htyderds.mysql.rds.aliyuncs.com" placeholder="请输入数据库连接地址" autocomplete="off" class="layui-input">
					    </div>
					  </div>
					  
					  <div class="layui-form-item">
					    <label class="layui-form-label">数据库端口</label>
					    <div class="layui-input-block">
					      <input type="text"  id="portinput"  name="title" required  lay-verify="required" value="3306" placeholder="请输入数据库端口" autocomplete="off" class="layui-input">
					    </div>
					  </div>
					  
					  <div class="layui-form-item">
					    <label class="layui-form-label">连接用户名</label>
					    <div class="layui-input-block">
					      <input type="text"  id="usernameinput"  name="title" required  lay-verify="required" value="han" placeholder="请输入用户名" autocomplete="off" class="layui-input">
					    </div>
					  </div>
					  
					  <div class="layui-form-item">
					    <label class="layui-form-label">连接密码</label>
					    <div class="layui-input-block">
					      <input type="password" id="passwordinput"  name="password" required lay-verify="required" value="P@ssw0rd" placeholder="请输入密码" autocomplete="off" class="layui-input">
					    </div>
					  </div> 
					  
					  <div class="layui-form-item">
					    <label class="layui-form-label">数据库</label>
					    <div class="layui-input-block">
					      <input type="text" id="databaseinput"  name="title" required  lay-verify="required" value="xianyan" placeholder="请输入数据库名称" autocomplete="off" class="layui-input">
					    </div>
					  </div>
					  
					  
					  <div class="layui-form-item">
					    <div class="layui-input-block">
						  <input type="button" style="position: relative;left: 130px;" class="layui-btn" id="getTables" value="获取数据库表结构" />
					    </div>
					  </div>
					  
					</form>
				</div>
				
					<div   id="tableinfo" style=" opacity: 0;width: 22%; height: 650px; overflow-y:auto;overflow-x: hidden; position: absolute;left:24%;top: 7%; ">
					  <blockquote class="layui-elem-quote">table列表
					  
					  </blockquote>
					  <table   class="layui-table">
					      
					      <thead>
					        <tr>
					          <th>序号</th>
					          <th>表名称</th>
							  <th>是否生成</th>
					        </tr> 
					      </thead>
					      <tbody id="tabletbody">
									
					      </tbody>
					    </table>
						
					  <input type="button" class="layui-btn" id="creatJavaFile" value="生成选中的表" />
					</div>
					
					<div id="inforight"  style=" opacity: 0;width: 50%; position: absolute;right:3%;top: 7%; ">
						<blockquote class="layui-elem-quote">table详情</blockquote>
						<table class="layui-table"  >
						    <colgroup>
						     
						    </colgroup>
						    <thead>
						      <tr>
								<th>序号</th> 
						        <th>列名</th>
						        <th>数据类型</th>
								<th>是否可为空</th>
								<th>键类型</th>
								<th>默认值</th>
								<th>注释</th>
						      </tr> 
						    </thead>
						    <tbody id="tabletbody2">
								
						    </tbody>
						  </table>
					</div>
				
				 
	</body>
</html>
